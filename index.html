<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <script src="https://rawgit.com/moment/moment/2.2.1/min/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <title>Farhin's Weather App.</title>
</head>
<style>
    #search-bar{
        margin:20px;
        width: 100%; 
        border:10px;
        padding:10px;
    }
    #current-weather{
        margin-top:20px;
        width:90%;
    }
    .col-lg-9{
        margin-top:10px;
    }
    #weather-info{
        margin-left:10px;
    }
    .body{
        background-color:darkblue;
        background-image:radial-gradient(rgb(118,182,250),rgb(16,43,82));
    

    }
    .card{
        background-color:rgb(65, 118, 158);
        color:antiquewhite;
        font-family: 'Courier New', Courier, monospace;
        
    }
    #current-weather{
        font-weight:bolder;

    }
    #cityHistory{
        background-color:lightgrey;
    }
    #Title{
        color:bisque;
        font-size:x-large;
    }
    #uv-card{
        width:fit-content;
        padding:3px;
        color:black;
    }

</style>
<body class= "body">
    <nav class="navbar navbar-dark bg-dark justify-content-center fixed" syle="margin-bottom:20px;">
        <div id = "Title" style = "float:left; margin-left:50px;margin-right:50px;">Farhin's Weather App</div>
        <span class="navbar-brand " id = "date">Today's Date: </span>
         <card type="text" id = "time" style="color:antiquewhite">Time Now
        </card>

    </nav>
    <div class = "row">
        <div class = "col-lg-2">
            <div id ="search-bar" class="card">
                <label>Search City:</label>
                <input id="city-input" placeholder="Enter City Here" style = "background-color:lightgrey">
                <button id="searchBtn" type="button" class="btn btn-primary">Search <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-search" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" d="M10.442 10.442a1 1 0 0 1 1.415 0l3.85 3.85a1 1 0 0 1-1.414 1.415l-3.85-3.85a1 1 0 0 1 0-1.415z"/>
                    <path fill-rule="evenodd" d="M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z"/>
                  </svg></button>
                <ul id = "cityHistory"class="list-group"></ul>
              </div>
        </div>
        <div class = "col-lg-10">
            <div class= "container" id = "weather-info">
                <h1 style = "color:antiquewhite;font-family: 'Courier New', Courier, monospace;margin:10px;font-weight:bolder;">Current Day Weather:</h1>
                <div id ="current-weather" class="card">
                    <div class="card-body">
                      <h1 class = city-name></h1>
                      <div id ="icon"></div>
                      <p id = "temp">Temperature:</p>
                      <p id = "humid">Humidity:</p>
                      <p id ="wind">Wind Speed:</p>
                      <p id = "uv">UV Index:</p>
                    </div>
                    
                </div>
                <br><br><br>
                <h2 style = "color:antiquewhite; font-family:'Courier New', Courier, monospace; font-weight: bolder;">5-Day Forcast:</h2>
                <div class = "row"id = "week-forcast">
                    <div id ="day-1" class ="card col-lg-2 m-3">
                        <div class="card-body" style = "padding:5px;padding-top: 10px;">
                            <h5 id = "day1">Day 1</h5>
                            <div id ="img1"></div>
                            <p class="card-text" id = "temp1"> </p> 
                            <p class="card-text" id = "humid1"> </p> 
                            <p class="card-text" id = "wind1"> </p> 
                            <p class="card-text uv" id = "uv1"> </p>              
                        </div>
                    </div>
                    <div id ="day-2" class ="card col-lg-2 m-3">
                        <div class="card-body"style = "padding:5px;padding-top: 10px;">
                            <h5 class="card-title" id = "day2">Day 2</h5>
                            <div id ="img2"></div>
                            <p class="card-text" id = "temp2"> </p> 
                            <p class="card-text" id = "humid2"> </p> 
                            <p class="card-text" id = "wind2"> </p> 
                            <p class="card-text uv" id = "uv2"> </p>           
                        </div>
                    </div>
                    <div id ="day-3" class ="card col-lg-2 m-3">
                        <div class="card-body"style = "padding:5px;padding-top: 10px;">
                            <h5 class="card-title"id = "day3">Day 3</h5>
                            <div id ="img3"></div>
                            <p class="card-text" id = "temp3"> </p> 
                            <p class="card-text" id = "humid3"> </p> 
                            <p class="card-text" id = "wind3"> </p> 
                            <p class="card-text uv" id = "uv3"> </p>            
                        </div>
                    </div>
                    <div id ="day-4" class ="card col-lg-2 m-3">
                        <div class="card-body"style = "padding:5px;padding-top: 10px;">
                            <h5 class="card-title" id = "day4">Day 4</h5>
                            <div id ="img4"></div>
                            <p class="card-text" id = "temp4"> </p> 
                            <p class="card-text" id = "humid4"> </p> 
                            <p class="card-text" id = "wind4"> </p> 
                            <p class="card-text uv" id = "uv4"> </p>           
                        </div>
                    </div>
                    <div id ="day-5" class ="card col-lg-2 m-3">
                        <div class="card-body"style = "padding:5px;padding-top: 10px;">
                            <h5 class="card-title " id = "day5">Day 5</h5>
                            <div id ="img5"></div>
                            <p class="card-text" id = "temp5"> </p> 
                            <p class="card-text" id = "humid5"> </p> 
                            <p class="card-text" id = "wind5"> </p> 
                            <p class="card-text uv" id = "uv5"> </p>              
                        </div>
                    </div>
            </div>
             
        </div>


        
    </div>

</body>
</html>
<script>
$("#date").text(moment().format("MMM Do YYYY"));   
$("#time").text(moment().format("LT")); 

document.querySelector("#searchBtn").addEventListener("click", 
function(){
    cityName = document.querySelector("#city-input").value
     getWeatherData();
     saveHistory();})

//APIS
var apiKey = "91ef0707ae600515288304e8c5d926b3"
var cityName = ""
var lat = ""
var lon = ""
var searchHistory = []
function saveHistory(){
    var cityList = JSON.parse(localStorage.cityList || "[]")
    cityList.push(cityName)
    localStorage.cityList =JSON.stringify(cityList)
    searchHistory = JSON.parse(localStorage.cityList);
    document.querySelector("#cityHistory").innerHTML = ``;
  //create city history list
  for (var i = 0; i < searchHistory.length; i++) {
    document.querySelector("#cityHistory").innerHTML += `<a class="list-group-item list-group-item-action" onClick="buttonSearch('${searchHistory[i]}')">${searchHistory[i]}</a>`;
  }
}

function buttonSearch(city){
    cityName=city
    getWeatherData()
}
function defaultPage(){
    cityName="Toronto"
    getWeatherData()
}
defaultPage()

function getWeatherData(){
    var queryUrl = `https://api.openweathermap.org/data/2.5/weather?q=${cityName}&appid=${apiKey}`;
    $.ajax({
        url: queryUrl,
        method: "GET",

    }).then(function (response){
        var temp = response.main.temp -273.15
        $("#temp").html(`Temp: ${(temp).toFixed(2)} \xB0C `);
        $(".city-name").html(`${response.name}`);
        $("#wind").html(`Wind: ${response.wind.speed} m/s `);
        $("#humid").html(`Humidity: ${response.main.humidity} %`);
        $("#icon").html(
      `<img class="ml-5" src="https://openweathermap.org/img/wn/${response.weather[0].icon}@2x.png"/>`);
    
    lat = response.coord.lat
    lon=response.coord.lon
    var URL2 = `https://api.openweathermap.org/data/2.5/onecall?lat=${lat}&lon=${lon}&units=metric&appid=${apiKey}`

    $.ajax({
        url: URL2,
        method: "GET",

    }).then(function (response){
        $("#temp1").html(`Temp.: ${response.daily[1].temp.day} \xB0C`);
        $("#day1").text(moment().add(1, "days").format("MMMM Do YYYY"));
        $("#humid1").html(`Humd.: ${response.daily[1].humidity}%`);
        $("#img1").html(
        `<img src="https://openweathermap.org/img/wn/${response.daily[1].weather[0].icon}@2x.png"/>`);
        $("#uv1").html(`UV Index: ${response.daily[1].uvi}`);
        
      
      $("#temp2").html(`Temp.: ${response.daily[2].temp.day}`);
        $("#day2").text(moment().add(2, "days").format("MMMM Do YYYY"));
        $("#humid2").html(`Humid.: ${response.daily[2].humidity}%`);
        $("#img2").html(
        `<img src="https://openweathermap.org/img/wn/${response.daily[2].weather[0].icon}@2x.png"/>`);
        $("#uv2").html(`UV Index: ${response.daily[2].uvi}`);

      $("#temp3").html(`Temp.: ${response.daily[3].temp.day}`);
        $("#day3").text(moment().add(3, "days").format("MMMM Do YYYY"));
        $("#humid3").html(`Humid.: ${response.daily[3].humidity}%`);
        $("#img3").html(
        `<img src="https://openweathermap.org/img/wn/${response.daily[3].weather[0].icon}@2x.png"/>`);
        $("#uv3").html(`UV Index: ${response.daily[3].uvi}`);
      $("#temp4").html(`Temp.: ${response.daily[4].temp.day}`);
        $("#day4").text(moment().add(4, "days").format("MMMM Do YYYY"));
        $("#humid4").html(`Humid.: ${response.daily[4].humidity}%`);
        $("#img4").html(
        `<img src="https://openweathermap.org/img/wn/${response.daily[4].weather[0].icon}@2x.png"/>`);
        $("#uv4").html(`UV Index: ${response.daily[4].uvi}`);
      $("#temp5").html(`Temp.: ${response.daily[5].temp.day}`);
        $("#day5").text(moment().add(5, "days").format("MMMM Do YYYY"));
        $("#humid5").html(`Humid.: ${response.daily[5].humidity}%`);
        $("#img5").html(
        `<img src="https://openweathermap.org/img/wn/${response.daily[5].weather[0].icon}@2x.png"/>`);
        $("#uv5").html(`UV Index:${response.daily[5].uvi}`);

    })
    var url3 = `https://api.openweathermap.org/data/2.5/uvi?lat=${lat}&lon=${lon}&appid=${apiKey}`
    $.ajax({
        url:url3,
        method:"GET",
    }).then(function(response){
        
        console.log(response.value)
        if(response.value<2){
            document.querySelector("#uv").innerHTML = `<div id= "uv-card"class = "card" style="background-color:skyblue;">${response.value}</div>`
        } else if(response.value>=2 && response.value<=5){
            document.querySelector("#uv").innerHTML = `<div id = "uv-card"class = "card" style="background-color:yellow;">${response.value}</div>`
        }else if(response.value > 5 && response.value <= 7){
            document.querySelector("#uv").innerHTML = `<div id="uv-card"class = "card" style="background-color:orange;">${response.value}</div>`
        }else if(response.value >= 8 && response.value <= 10){
            document.querySelector("#uv").innerHTML = `<div id="uv-card"class = "card" style="background-color:red;">${response.value}</div>`
        }
    })



    })
}








</script>